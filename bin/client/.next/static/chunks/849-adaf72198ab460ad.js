"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[849],{9843:function(e,t,a){a.r(t),a.d(t,{default:function(){return InsertMember}});var s=a(5893),n=a(2006),l=a(7115),r=a(5506),i=a(7519),d=a(5057),c=a(7945),o=a(3104),u=a(2361),m=a(9091),h=a(7294);function InsertMember(e){let{onClose:t}=e,a=(0,r.TL)(),[x,p]=(0,h.useState)(!1),{error:j,state:y,formKey:b,handleInput:f,handleSubmit:g,resetForm:v}=(0,n.Z)({schema:d.pN}),N=(0,h.useCallback)(()=>{p(e=>!e)},[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{onClose:t,children:(0,s.jsxs)("div",{className:"member-insert",children:[(0,s.jsx)("h2",{className:"member-insert--heading",children:"Insert Member"}),(0,s.jsx)("div",{className:"member-insert--form",children:(0,s.jsxs)("div",{className:"member-insert--form",children:[(0,s.jsx)("h4",{className:"member-insert--heading",children:"Basic Information:"}),(0,s.jsx)(u.Z,{id:"fullName",isRequired:!0,label:"Fullname",placeholder:"eg. Naran Neu..",name:"fullName",onChange:f,defaultValue:y.fullName,error:j.fullName,autoFocus:!0}),(0,s.jsx)(u.Z,{id:"address",isRequired:!0,label:"Address",placeholder:"eg. Kathmandu, Nepal..",name:"address",onChange:f,defaultValue:y.address,error:j.address}),(0,s.jsx)(u.Z,{id:"phone",isRequired:!0,label:"Phone",placeholder:"eg. 98XXXXXX..",name:"phone",onChange:f,defaultValue:y.phone,error:j.phone,instruction:"* Please note this number will be used to identify the member and cannot be changed afterwards."})]})},b),(0,s.jsx)("div",{className:"member-insert--actions",children:(0,s.jsx)(c.Z,{label:"Save",type:"primary",onClick:N,style:{minWidth:"13rem"}})})]})}),x?(0,s.jsx)(o.Z,{cancel:N,confirm:()=>{g(e=>{a((0,i.Di)({data:e,callback:()=>{N(),v(),(0,l.Qm)("Member inserted")}}))})},title:"Confirm Insert",message:"Are you sure you want to add this item to list?"}):null]})}},7849:function(e,t,a){a.r(t),a.d(t,{default:function(){return InsertSales}});var s=a(5893),n=a(3401),l=a(7115),r=a(365),i=a(5506),d=a(7519),c=a(5382),o=a(5053),u=a(7945),m=a(3104),h=a(2361),x=a(9091),p=a(4200),j=a(7294),y=a(6078),b=a(9329),f=a(8274),g=a(9843),v=a(7784);let N=[{name:"title",display:"Title"},{name:"amount",display:"Amount"},{name:"quantity",display:"Quantity"},{name:"subtotal",display:"Sub Total"},{name:"actions",display:"Actions"}];function InsertSales(e){let{onClose:t}=e,a=(0,i.TL)(),n=(0,i.CG)(e=>e.system),m=(0,i.CG)(e=>e.product),N=(0,i.CG)(e=>e.member),[S,C]=(0,j.useState)([]),[k,q]=(0,j.useState)({}),[w,I]=(0,j.useState)(0),[P,Z]=(0,j.useState)(),[D,_]=(0,j.useState)(null),[M,O]=(0,j.useState)(new Date),[R,F]=(0,j.useState)(null),handleMemberInsert=()=>a((0,f.jb)(!N.insert)),handleProductInsert=()=>a((0,r.US)(!m.insert)),handleProductStock=e=>a((0,r.y)(e));(0,j.useEffect)(()=>{(!m.expires||m.expires&&m.expires-Date.now()<0)&&a((0,c.Xp)())},[m.expires,a]);let handleRemark=e=>{F(e||null)},handleSalesDate=e=>{let t=new Date(e);t instanceof Date&&O(t)},handleMemberDetail=e=>{_(e)},handlePaymentMethod=e=>{Z(e),"Credit"===e?(!N.expires||N.expires&&N.expires-Date.now()<0)&&a((0,d.Zw)()):_("")},resetCart=()=>{q({}),I(0),Z(void 0),_("")},handleDiscount=e=>{let t=Object.values(k).reduce((e,t)=>e=+e+ +t.subtotal,0);(e>t||e<0)&&(e=0),I(e)},addToBag=e=>{if(1>+e.quantity)return;let t=k[e.id];t?q(a=>({...a,[e.id]:{...t,quantity:(+t.quantity+1).toString(),subtotal:(+t.amount*(+t.quantity+1)).toString()}})):q(t=>({...t,[e.id]:{amount:e.sellingPrice,quantity:"1",subtotal:e.sellingPrice,title:e.title,productId:e.id,limit:e.quantity}}))};return(0,j.useEffect)(()=>{C(m.data)},[m.data]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{onClose:t,children:(0,s.jsxs)("div",{className:"sales-insert fixed",children:[(0,s.jsx)("h2",{className:"sales-insert--heading",children:"Create Sales"}),(0,s.jsxs)("div",{className:"sales-insert--panel",children:[(0,s.jsxs)("div",{className:"sales-insert--panel__left",children:[(0,s.jsx)("br",{}),(0,s.jsx)("h4",{className:"sales-insert--heading",children:"Products:"}),(0,s.jsxs)("div",{className:"sales-insert--group",children:[(0,s.jsx)(h.Z,{id:"searchProduct",name:"searchProduct",placeholder:"Search Product",onChange:e=>{let t=e.target.value.trim().toLowerCase(),a=m.data.filter(e=>!!(e.title.toLowerCase().indexOf(t)>-1||e.code.toLowerCase().indexOf(t)>-1||(e.tags||"").toLowerCase().indexOf(t)>-1||(e.description||"").toLowerCase().indexOf(t)>-1));C(a)}}),(0,s.jsx)(u.Z,{label:(0,s.jsx)("span",{children:(0,s.jsx)("i",{className:"fa-regular fa-plus"})}),type:"primary",style:{minWidth:"4rem"},onClick:()=>handleProductInsert()})]}),(0,s.jsx)("div",{className:"sales-insert--products",children:S.length>0?S.map((e,t)=>(0,s.jsxs)("div",{className:"sales-insert--products__item",onClick:()=>addToBag(e),children:[(0,s.jsxs)("div",{className:"sales-insert--products__item-left",children:[(0,s.jsxs)("p",{children:[e.title," (",e.code,")"]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("span",{className:"label primary-label",children:["Rack: ",e.rack]}),(0,s.jsx)("span",{className:"label ".concat(1>+e.quantity?"secondary":10>+e.quantity?"error":"success","-label"),onClick:t=>(t.stopPropagation(),handleProductStock(e)),children:1>+e.quantity?"Out of Stock":"".concat(e.quantity," In Stock")})]})]}),(0,s.jsxs)("div",{className:"sales-insert--products__item-right",children:["Rs.",e.sellingPrice]})]},t)):(0,s.jsx)("div",{className:"noresult",children:"No Product Details Found"})})]}),(0,s.jsxs)("div",{className:"sales-insert--panel__right",children:[(0,s.jsx)(RunningSalesTable,{data:Object.values(k),changeCartItemAmount:(e,t)=>{let a=k[e];q(s=>({...s,[e]:{...a,amount:t.toString(),subtotal:(t*+a.quantity).toString()}}))},decreaseCartItemQuantity:e=>{let t=k[e];if(!t||1>=+t.quantity)return;let a=+t.quantity-1;q(s=>({...s,[e]:{...t,quantity:a.toString(),subtotal:(+a*+t.amount).toString()}}))},increaseCartItemQuantity:e=>{let t=k[e];if(!t||+t.quantity>=+t.limit)return;let a=+t.quantity+1;q(s=>({...s,[e]:{...t,quantity:a.toString(),subtotal:(+a*+t.amount).toString()}}))},removeItemFromCart:e=>{q(t=>{let a={...t};return delete a[e],a})},resetCart:resetCart,submitOrder:()=>{if(!P)return(0,l.Iv)("Payment Method is required");if("Credit"===P&&!D)return(0,l.Iv)("Please select member");let e=Object.values(k).map(e=>({sellingPrice:e.amount.toString(),title:e.title,productId:e.productId,quantity:e.quantity}));a((0,o.K2)({data:{date:M.toISOString(),discount:w.toString(),items:e,type:P,memberId:D||void 0,remark:R||void 0},callback:()=>{resetCart(),(0,l.Qm)("Sales created"),setTimeout(()=>{a((0,r.Fw)(e.map(e=>({id:e.productId,quantity:-1*+e.quantity}))))},500)}}))}},Object.keys(k).length),(0,s.jsx)("br",{}),Object.keys(k).length>0&&(0,s.jsx)("table",{className:"product-stock--grid",width:"70%",children:(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Summery:"}),(0,s.jsx)("td",{})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Sales Date:"}),(0,s.jsx)("td",{children:(0,s.jsx)(h.Z,{type:"date",id:"date",name:"date",style:{width:"25rem"},defaultValue:(0,v.zM)(M),max:(0,v.zM)(new Date),onChange:e=>handleSalesDate(e.target.value)})})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Payment Method"}),(0,s.jsx)("td",{children:(0,s.jsx)(p.Z,{placeholder:"Select Option",options:[{value:"Credit"},{value:"Cash"},{value:"Online"}],style:{width:"25rem"},onChange:e=>handlePaymentMethod(e.target.value),showSearch:!0,defaultValue:P})})]}),"Credit"===P?(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Member"}),(0,s.jsx)("td",{children:(0,s.jsxs)("div",{style:{display:"flex",gap:".3rem"},children:[(0,s.jsx)(p.Z,{placeholder:"Select member",showSearch:!0,options:N.data.map(e=>({value:e.id,displayValue:"".concat(e.fullName," (").concat(e.phone,")"),search:"".concat(e.fullName," ").concat(e.phone," ").concat(e.address)})),style:{width:"25rem"},onChange:e=>handleMemberDetail(e.target.value),defaultValue:null!=D?D:void 0}),(0,s.jsx)(u.Z,{label:(0,s.jsx)("span",{children:(0,s.jsx)("i",{className:"fa-regular fa-plus"})}),type:"primary",style:{minWidth:"4rem"},onClick:()=>handleMemberInsert()})]})})]}):null,(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Subtotal"}),(0,s.jsxs)("td",{children:["Rs.",Object.values(k).reduce((e,t)=>e=+e+ +t.subtotal,0)," ","(",Object.keys(k).length," Item/s)"]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Discount"}),(0,s.jsx)("td",{children:(0,s.jsx)(h.Z,{style:{width:"25rem"},type:"number",defaultValue:w,onBlur:e=>handleDiscount(+e.target.value)})})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Total Amount"}),(0,s.jsxs)("td",{children:["Rs.",Object.values(k).reduce((e,t)=>e=+e+ +t.subtotal,0)-w]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Remark"}),(0,s.jsx)("td",{children:(0,s.jsx)(h.Z,{style:{width:"25rem"},defaultValue:R,onChange:e=>handleRemark(e.target.value.trim()),placeholder:"Leave a note"})})]})]})}),(0,s.jsx)("br",{}),Object.keys(k).length>0&&"Credit"===P&&!D&&(0,s.jsx)("p",{className:"sales-insert--panel__right-notice",children:"Payment Notice: Member is required when the payment type is credit."})]})]})]})}),m.insert?(0,s.jsx)(y.default,{onClose:handleProductInsert,theme:n.theme}):null,N.insert?(0,s.jsx)(g.default,{onClose:handleMemberInsert}):null,m.stock&&"string"!=typeof m.stock?(0,s.jsx)(b.default,{onClose:()=>handleProductStock(null),selectedProduct:m.stock}):null]})}let RunningSalesTable=e=>{let{data:t,changeCartItemAmount:a,decreaseCartItemQuantity:l,increaseCartItemQuantity:r,removeItemFromCart:i,resetCart:d,submitOrder:c}=e,[o,x]=(0,j.useState)(!1),[p,y]=(0,j.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{disableControls:!0,customActions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{label:(0,s.jsxs)("span",{children:[(0,s.jsx)("i",{className:"fa-regular fa-plus"})," Create"]}),type:"primary",style:{minWidth:"10rem"},onClick:()=>y(!0)}),(0,s.jsx)(u.Z,{label:"Reset",type:"error",className:"duotone",style:{minWidth:"10rem"},onClick:()=>x(!0)})]}),headings:N,rawData:t.map((e,t)=>({title:{value:e.title},amount:{value:e.amount,display:(0,s.jsx)(h.Z,{style:{width:"10rem"},type:"number",defaultValue:e.amount,onBlur:t=>a(e.productId,+t.target.value)})},quantity:{value:e.quantity,display:(0,s.jsxs)("div",{className:"table-content--actions",children:[(0,s.jsx)(u.Z,{label:(0,s.jsx)("i",{className:"fa-regular fa-minus"}),type:"primary",className:"table-content--actions__btn duotone",onClick:()=>l(e.productId)}),(0,s.jsx)("div",{className:"table-content--label",children:e.quantity}),(0,s.jsx)(u.Z,{label:(0,s.jsx)("i",{className:"fa-regular fa-plus"}),type:"primary",className:"table-content--actions__btn duotone",onClick:()=>r(e.productId)})]})},subtotal:{value:"Rs."+e.subtotal},actions:{value:"",display:(0,s.jsx)("div",{className:"table-content--actions",children:(0,s.jsx)(u.Z,{label:(0,s.jsx)("i",{className:"fa-regular fa-times"}),type:"error",className:"table-content--actions__btn duotone",onClick:()=>i(e.productId)})})}}))}),o?(0,s.jsx)(m.Z,{cancel:()=>x(!1),confirm:d,title:"Confirm Reset",message:"Are you sure you want to reset current cart?"}):null,p?(0,s.jsx)(m.Z,{cancel:()=>y(!1),confirm:c,title:"Place Order",message:"Are you sure you want to place order?"}):null]})}},9329:function(e,t,a){a.r(t),a.d(t,{default:function(){return ManageStock}});var s=a(5893),n=a(5506),l=a(9091),r=a(7294),i=a(647),d=a(84),c=a(4001),o=a(1091);function ManageStock(e){let{onClose:t,selectedProduct:a}=e,u=(0,n.TL)(),m=(0,n.CG)(e=>e.stock);return(0,r.useEffect)(()=>(a?u((0,i.gj)(a.id)):u((0,i.Sn)()),()=>{u((0,c.a_)([]))}),[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{onClose:t,children:(0,s.jsxs)("div",{className:"product-stock",children:[(0,s.jsx)("h2",{className:"product-stock--heading",children:a?a.title:"Manage Stocks"}),(0,s.jsx)(d.default,{data:m.data,handleInsert:()=>u((0,c.US)(!m.insert))})]})}),m.loading?(0,s.jsx)(o.Z,{overlay:!0}):null]})}},84:function(e,t,a){a.r(t),a.d(t,{default:function(){return StockTable}});var s=a(5893),n=a(3401);let l=[{name:"date",display:"Date"},{name:"billNumber",display:"Bill Number"},{name:"vendor",display:"Vendor"},{name:"product",display:"Product"},{name:"per",display:"Price"},{name:"quantity",display:"Quantity"},{name:"totalAmount",display:"Total Amount"},{name:"entryDate",display:"Entry Date"}];function StockTable(e){let{data:t,handleInsert:a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{headings:l,exportSchema:["date","vendor","product","quantity","totalAmount","entryDate"],rawData:t.map((e,t)=>{var a,n;return{date:{value:new Date(e.date).toLocaleDateString()},billNumber:{value:e.bill.billNumber},vendor:{value:null!==(a=e.vendor.name)&&void 0!==a?a:e.vendor.id},product:{value:null!==(n=e.product.title)&&void 0!==n?n:e.product.id},quantity:{value:e.quantity,display:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("strong",{className:"".concat(0>+e.quantity?"error":"success","-color"),children:"".concat(0>+e.quantity?"":"+").concat(e.quantity)})})},per:{value:"Rs."+(+e.amount).toFixed(2)},totalAmount:{value:"Rs."+(+e.amount*+e.quantity).toFixed(2)},entryDate:{value:new Date(e.inserted).toLocaleDateString()}}})}),(0,s.jsx)("table",{className:"product-stock--grid",width:"30%",children:(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Summery:"}),(0,s.jsx)("td",{})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Total Entries"}),(0,s.jsx)("td",{children:t.length})]})]})})]})}},5057:function(e,t,a){a.d(t,{Nw:function(){return l},pN:function(){return r}});var s=a(1604),n=a(3232);let l=s.z.object({id:(0,n.G5)("ID"),phone:(0,n.G5)("Phone",10,10),fullName:(0,n.G5)("FullName"),address:(0,n.G5)("Address"),inserted:(0,n.G5)("Inserted"),updated:(0,n.G5)("Updated")}),r=l.omit({id:!0,inserted:!0,updated:!0});l.pick({id:!0})}}]);