"use strict";exports.id=7849,exports.ids=[7849],exports.modules={7849:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>InsertSales});var l=a(997),n=a(3401),r=a(7115),i=a(365),d=a(7813),c=a(7519),o=a(5382),u=a(5053),m=a(7945),h=a(3104),x=a(2361),j=a(9091),p=a(4200),y=a(6689),b=a(6078),g=a(9329),f=a(8274),S=a(9843),v=a(7784),C=e([r,i,d,c,o,u,h,b,g,f,S,v]);[r,i,d,c,o,u,h,b,g,f,S,v]=C.then?(await C)():C;let N=[{name:"title",display:"Title"},{name:"amount",display:"Amount"},{name:"quantity",display:"Quantity"},{name:"subtotal",display:"Sub Total"},{name:"actions",display:"Actions"}];function InsertSales({onClose:e}){let t=(0,d.TL)(),a=(0,d.CG)(e=>e.system),s=(0,d.CG)(e=>e.product),n=(0,d.CG)(e=>e.member),[h,C]=(0,y.useState)([]),[N,k]=(0,y.useState)({}),[q,w]=(0,y.useState)(0),[I,P]=(0,y.useState)(),[O,Z]=(0,y.useState)(null),[_,D]=(0,y.useState)(new Date),[M,R]=(0,y.useState)(null),handleMemberInsert=()=>t((0,f.jb)(!n.insert)),handleProductInsert=()=>t((0,i.US)(!s.insert)),handleProductStock=e=>t((0,i.y)(e));(0,y.useEffect)(()=>{(!s.expires||s.expires&&s.expires-Date.now()<0)&&t((0,o.Xp)())},[s.expires,t]);let handleRemark=e=>{R(e||null)},handleSalesDate=e=>{let t=new Date(e);t instanceof Date&&D(t)},handleMemberDetail=e=>{Z(e)},handlePaymentMethod=e=>{P(e),"Credit"===e?(!n.expires||n.expires&&n.expires-Date.now()<0)&&t((0,c.Zw)()):Z("")},resetCart=()=>{k({}),w(0),P(void 0),Z("")},handleDiscount=e=>{let t=Object.values(N).reduce((e,t)=>e=+e+ +t.subtotal,0);(e>t||e<0)&&(e=0),w(e)},addToBag=e=>{if(1>+e.quantity)return;let t=N[e.id];t?k(a=>({...a,[e.id]:{...t,quantity:(+t.quantity+1).toString(),subtotal:(+t.amount*(+t.quantity+1)).toString()}})):k(t=>({...t,[e.id]:{amount:e.sellingPrice,quantity:"1",subtotal:e.sellingPrice,title:e.title,productId:e.id,limit:e.quantity}}))};return(0,y.useEffect)(()=>{C(s.data)},[s.data]),(0,l.jsxs)(l.Fragment,{children:[l.jsx(j.Z,{onClose:e,children:(0,l.jsxs)("div",{className:"sales-insert fixed",children:[l.jsx("h2",{className:"sales-insert--heading",children:"Create Sales"}),(0,l.jsxs)("div",{className:"sales-insert--panel",children:[(0,l.jsxs)("div",{className:"sales-insert--panel__left",children:[l.jsx("br",{}),l.jsx("h4",{className:"sales-insert--heading",children:"Products:"}),(0,l.jsxs)("div",{className:"sales-insert--group",children:[l.jsx(x.Z,{id:"searchProduct",name:"searchProduct",placeholder:"Search Product",onChange:e=>{let t=e.target.value.trim().toLowerCase(),a=s.data.filter(e=>!!(e.title.toLowerCase().indexOf(t)>-1||e.code.toLowerCase().indexOf(t)>-1||(e.tags||"").toLowerCase().indexOf(t)>-1||(e.description||"").toLowerCase().indexOf(t)>-1));C(a)}}),l.jsx(m.Z,{label:l.jsx("span",{children:l.jsx("i",{className:"fa-regular fa-plus"})}),type:"primary",style:{minWidth:"4rem"},onClick:()=>handleProductInsert()})]}),l.jsx("div",{className:"sales-insert--products",children:h.length>0?h.map((e,t)=>(0,l.jsxs)("div",{className:"sales-insert--products__item",onClick:()=>addToBag(e),children:[(0,l.jsxs)("div",{className:"sales-insert--products__item-left",children:[(0,l.jsxs)("p",{children:[e.title," (",e.code,")"]}),(0,l.jsxs)("p",{children:[(0,l.jsxs)("span",{className:"label primary-label",children:["Rack: ",e.rack]}),l.jsx("span",{className:`label ${1>+e.quantity?"secondary":10>+e.quantity?"error":"success"}-label`,onClick:t=>(t.stopPropagation(),handleProductStock(e)),children:1>+e.quantity?"Out of Stock":`${e.quantity} In Stock`})]})]}),(0,l.jsxs)("div",{className:"sales-insert--products__item-right",children:["Rs.",e.sellingPrice]})]},t)):l.jsx("div",{className:"noresult",children:"No Product Details Found"})})]}),(0,l.jsxs)("div",{className:"sales-insert--panel__right",children:[l.jsx(RunningSalesTable,{data:Object.values(N),changeCartItemAmount:(e,t)=>{let a=N[e];k(s=>({...s,[e]:{...a,amount:t.toString(),subtotal:(t*+a.quantity).toString()}}))},decreaseCartItemQuantity:e=>{let t=N[e];if(!t||1>=+t.quantity)return;let a=+t.quantity-1;k(s=>({...s,[e]:{...t,quantity:a.toString(),subtotal:(+a*+t.amount).toString()}}))},increaseCartItemQuantity:e=>{let t=N[e];if(!t||+t.quantity>=+t.limit)return;let a=+t.quantity+1;k(s=>({...s,[e]:{...t,quantity:a.toString(),subtotal:(+a*+t.amount).toString()}}))},removeItemFromCart:e=>{k(t=>{let a={...t};return delete a[e],a})},resetCart:resetCart,submitOrder:()=>{if(!I)return(0,r.Iv)("Payment Method is required");if("Credit"===I&&!O)return(0,r.Iv)("Please select member");let e=Object.values(N).map(e=>({sellingPrice:e.amount.toString(),title:e.title,productId:e.productId,quantity:e.quantity}));t((0,u.K2)({data:{date:_.toISOString(),discount:q.toString(),items:e,type:I,memberId:O||void 0,remark:M||void 0},callback:()=>{resetCart(),(0,r.Qm)("Sales created"),setTimeout(()=>{t((0,i.Fw)(e.map(e=>({id:e.productId,quantity:-1*+e.quantity}))))},500)}}))}},Object.keys(N).length),l.jsx("br",{}),Object.keys(N).length>0&&l.jsx("table",{className:"product-stock--grid",width:"70%",children:(0,l.jsxs)("tbody",{children:[(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Summery:"}),l.jsx("td",{})]}),(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Sales Date:"}),l.jsx("td",{children:l.jsx(x.Z,{type:"date",id:"date",name:"date",style:{width:"25rem"},defaultValue:(0,v.zM)(_),max:(0,v.zM)(new Date),onChange:e=>handleSalesDate(e.target.value)})})]}),(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Payment Method"}),l.jsx("td",{children:l.jsx(p.Z,{placeholder:"Select Option",options:[{value:"Credit"},{value:"Cash"},{value:"Online"}],style:{width:"25rem"},onChange:e=>handlePaymentMethod(e.target.value),showSearch:!0,defaultValue:I})})]}),"Credit"===I?(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Member"}),l.jsx("td",{children:(0,l.jsxs)("div",{style:{display:"flex",gap:".3rem"},children:[l.jsx(p.Z,{placeholder:"Select member",showSearch:!0,options:n.data.map(e=>({value:e.id,displayValue:`${e.fullName} (${e.phone})`,search:`${e.fullName} ${e.phone} ${e.address}`})),style:{width:"25rem"},onChange:e=>handleMemberDetail(e.target.value),defaultValue:O??void 0}),l.jsx(m.Z,{label:l.jsx("span",{children:l.jsx("i",{className:"fa-regular fa-plus"})}),type:"primary",style:{minWidth:"4rem"},onClick:()=>handleMemberInsert()})]})})]}):null,(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Subtotal"}),(0,l.jsxs)("td",{children:["Rs.",Object.values(N).reduce((e,t)=>e=+e+ +t.subtotal,0)," ","(",Object.keys(N).length," Item/s)"]})]}),(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Discount"}),l.jsx("td",{children:l.jsx(x.Z,{style:{width:"25rem"},type:"number",defaultValue:q,onBlur:e=>handleDiscount(+e.target.value)})})]}),(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Total Amount"}),(0,l.jsxs)("td",{children:["Rs.",Object.values(N).reduce((e,t)=>e=+e+ +t.subtotal,0)-q]})]}),(0,l.jsxs)("tr",{children:[l.jsx("th",{children:"Remark"}),l.jsx("td",{children:l.jsx(x.Z,{style:{width:"25rem"},defaultValue:M,onChange:e=>handleRemark(e.target.value.trim()),placeholder:"Leave a note"})})]})]})}),l.jsx("br",{}),Object.keys(N).length>0&&"Credit"===I&&!O&&l.jsx("p",{className:"sales-insert--panel__right-notice",children:"Payment Notice: Member is required when the payment type is credit."})]})]})]})}),s.insert?l.jsx(b.default,{onClose:handleProductInsert,theme:a.theme}):null,n.insert?l.jsx(S.default,{onClose:handleMemberInsert}):null,s.stock&&"string"!=typeof s.stock?l.jsx(g.default,{onClose:()=>handleProductStock(null),selectedProduct:s.stock}):null]})}let RunningSalesTable=({data:e,changeCartItemAmount:t,decreaseCartItemQuantity:a,increaseCartItemQuantity:s,removeItemFromCart:r,resetCart:i,submitOrder:d})=>{let[c,o]=(0,y.useState)(!1),[u,j]=(0,y.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[l.jsx(n.Z,{disableControls:!0,defaultPageSize:100,customActions:(0,l.jsxs)(l.Fragment,{children:[l.jsx(m.Z,{label:(0,l.jsxs)("span",{children:[l.jsx("i",{className:"fa-regular fa-plus"})," Create"]}),type:"primary",style:{minWidth:"10rem"},onClick:()=>j(!0)}),l.jsx(m.Z,{label:"Reset",type:"error",className:"duotone",style:{minWidth:"10rem"},onClick:()=>o(!0)})]}),headings:N,rawData:e.map((e,n)=>({title:{value:e.title},amount:{value:e.amount,display:l.jsx(x.Z,{style:{width:"10rem"},type:"number",defaultValue:e.amount,onBlur:a=>t(e.productId,+a.target.value)})},quantity:{value:e.quantity,display:(0,l.jsxs)("div",{className:"table-content--actions",children:[l.jsx(m.Z,{label:l.jsx("i",{className:"fa-regular fa-minus"}),type:"primary",className:"table-content--actions__btn duotone",onClick:()=>a(e.productId)}),l.jsx("div",{className:"table-content--label",children:e.quantity}),l.jsx(m.Z,{label:l.jsx("i",{className:"fa-regular fa-plus"}),type:"primary",className:"table-content--actions__btn duotone",onClick:()=>s(e.productId)})]})},subtotal:{value:"Rs."+e.subtotal},actions:{value:"",display:l.jsx("div",{className:"table-content--actions",children:l.jsx(m.Z,{label:l.jsx("i",{className:"fa-regular fa-times"}),type:"error",className:"table-content--actions__btn duotone",onClick:()=>r(e.productId)})})}}))}),c?l.jsx(h.Z,{cancel:()=>o(!1),confirm:i,title:"Confirm Reset",message:"Are you sure you want to reset current cart?"}):null,u?l.jsx(h.Z,{cancel:()=>j(!1),confirm:d,title:"Place Order",message:"Are you sure you want to place order?"}):null]})};s()}catch(e){s(e)}})}};